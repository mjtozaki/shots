<!DOCTYPE html>
<html>
<head>
  <link href="https://fonts.googleapis.com/css?family=Roboto:300,900" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="shots.css">
  
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/js-url/2.5.3/url.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-1.45.2.min.js"></script>
  <!-- Better date formatting. -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
  <!-- Compression. https://github.com/nodeca/pako/blob/master/examples/browser.html -->
  <script src="https://cdn.jsdelivr.net/pako/1.0.3/pako.min.js"></script>
  
</head>
<body>
  <div id="root" />

  <script src="https://unpkg.com/react@16/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@16/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-router@5.0.0/umd/react-router.min.js"></script>
  <script src="https://unpkg.com/react-router-dom@5.0.0/umd/react-router-dom.min.js"></script>
  <script src="https://unpkg.com/react-hyperscript-helpers@2.0.0/umd/react-hyperscript-helpers.min.js"></script>
  <script src="https://unpkg.com/react-plotly.js@2.2.0/dist/create-plotly-component.min.js"></script> <!-- 2.3.0 is broken. -->
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/4.0.1/redux.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-redux/6.0.1/react-redux.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/redux-thunk/2.3.0/redux-thunk.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/redux-form/8.1.0/redux-form.min.js"></script>
  <script src="https://unpkg.com/redux-actions@2.6.5/dist/redux-actions.min.js"></script>

  
  <script src="imports.js" type="text/javascript"></script>
  <script src="decent.js" type="text/javascript"></script>
  <script src="gapi_wrapper.js" type="text/javascript"></script>
  <script src="gapi_shot_storage.js" type="text/javascript"></script>
  <script src="shot_serialization.js" type="text/javascript"></script>
  
  <script src="actions.js" type="text/javascript"></script>
  <script src="reducers.js" type="text/javascript"></script>
  <script src="redirects.js" type="text/javascript"></script>

  <script src="auth_settings.js" type="text/javascript"></script>
  <script src="menu.js" type="text/javascript"></script>
  <script src="shot_listing.js" type="text/javascript"></script>
  <script src="single_shot_view.js" type="text/javascript"></script>
  <script src="sharing_widget.js" type="text/javascript"></script>
  <script src="shots_app.js" type="text/javascript"></script>

  <script type="text/javascript">
    // From https://stackoverflow.com/a/2117523
    function uuidv4() {
      return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
        (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
      )
    }

    // From https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API#Testing_for_availability
    function storageAvailable(type) {
      try {
        var storage = window[type],
            x = '__storage_test__';
        storage.setItem(x, x);
        storage.removeItem(x);
        return true;
      }
      catch(e) {
        return e instanceof DOMException && (
          // everything except Firefox
          e.code === 22 ||
          // Firefox
          e.code === 1014 ||
          // test name field too, because code might not be present
          // everything except Firefox
          e.name === 'QuotaExceededError' ||
          // Firefox
          e.name === 'NS_ERROR_DOM_QUOTA_REACHED') &&
          // acknowledge QuotaExceededError only if there's something already stored
          storage.length !== 0;
      }
    }

    (function(ns = window) {
      const getPersistentAuth = () => {
        try {
          <!-- let apiKey = window.localStorage.getItem('api_key'); -->
          let clientId = window.localStorage.getItem('client_id');
          let clientSecret = window.localStorage.getItem('client_secret');
          let refreshToken = window.localStorage.getItem('refresh_token');
          
          return {
            <!-- apiKey: (apiKey !== null) ? apiKey : undefined, -->
            clientId: (clientId !== null) ? clientId : undefined,
            clientSecret: (clientSecret !== null) ? clientSecret : undefined,
            refreshToken: (refreshToken !== null) ? refreshToken : undefined,
          };
        } catch (e) {
          return {};
        }
      };
      function gapi_loaded() {
        var enableLocalStorage = storageAvailable('localStorage');
        const rootContainer = document.querySelector('#root');
        
         // All the APIs we need.
        let apis = {
          shotSerializer: new ShotSerializer(),
          shotStorage: new GapiShotStorage(GapiWrapper, new ShotCodec()),
        };
        
        let initialState = {
          auth: {...getPersistentAuth()},
        };
        
        const store = createStore(
          rootReducer,
          initialState,
          applyMiddleware(
            thunk.withExtraArgument(apis)
          ));
        
        var shotsApp = ReactDOM.render(
          <!-- React.createElement(ShotsApp, { -->
            <!-- enableLocalStorage: enableLocalStorage, -->
          <!-- }), -->
          h(Provider, {store: store}, [
            h(Router, [
              h(Route, {path: '/', component: AuthSyncedShotsApp}),
            ]),
          ]),
          rootContainer);
//        shotsApp.route();
      }
      
      ns.gapi_loaded = gapi_loaded;
    })();
  </script>

  
  <script type="text/javascript" src="https://apis.google.com/js/client.js?onload=gapi_loaded"></script>
</body>
</html>
